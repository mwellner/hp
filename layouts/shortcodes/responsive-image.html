{{ $image := .Page.Resources.GetMatch (.Get "name") }}
{{ $image32 := $image.Resize "32x" }}
{{ $image320 := $image.Resize "320x" }}
{{ $image640 := $image.Resize "640x" }}
{{ $image800 := $image.Resize "800x" }}
{{ $image1300 := $image.Resize "1300x" }}
{{ $image1600 := $image.Resize "1600x" }}

<figure {{ with .Get "class" }} class="{{.}}" {{ end }}>
  <img class="lazy" sizes="100vw" 
    src="data:image/jpeg;base64,{{ $image32.Content | base64Encode }}" 
    data-srcset="{{$image320.RelPermalink}} 320w, {{$image640.RelPermalink}} 640w, {{$image800.RelPermalink}} 1000w, {{$image1300.RelPermalink}} 1600w, {{$image1600.RelPermalink}} 1800w"
    {{ with $image.Title }} alt="{{.}}" {{ end }}
  >
  {{ with $image.Title }}
  <figcaption>{{.}}</figcaption>
  {{ end }}
</figure>